<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:Aihao.ViewModels"
        xmlns:models="using:Aihao.Models"
        xmlns:dock="using:Aihao.ViewModels.Docking"
        xmlns:views="using:Aihao.Views"
        xmlns:dockViews="using:Aihao.Views.Dock"
        xmlns:idc="clr-namespace:Dock.Avalonia.Controls;assembly=Dock.Avalonia"
        mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="900"
        x:Class="Aihao.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding Title}"
        Width="1400" Height="900"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource EditorBackgroundBrush}">
    
    <Window.KeyBindings>
        <KeyBinding Gesture="Ctrl+O" Command="{Binding OpenProjectCommand}"/>
        <KeyBinding Gesture="Ctrl+S" Command="{Binding SaveProjectCommand}"/>
        <KeyBinding Gesture="Ctrl+Shift+B" Command="{Binding BuildProjectCommand}"/>
        <KeyBinding Gesture="F5" Command="{Binding RunGameCommand}"/>
        <KeyBinding Gesture="Ctrl+F5" Command="{Binding DebugGameCommand}"/>
        <KeyBinding Gesture="Shift+F5" Command="{Binding StopGameCommand}"/>
        <KeyBinding Gesture="Ctrl+OemComma" Command="{Binding OpenSettingsCommand}"/>
        <KeyBinding Gesture="Ctrl+Shift+K" Command="{Binding OpenKeybindingsCommand}"/>
        <KeyBinding Gesture="Ctrl+P" Command="{Binding OpenQuickOpenCommand}"/>
        <KeyBinding Gesture="Ctrl+Shift+P" Command="{Binding OpenCommandPaletteCommand}"/>
    </Window.KeyBindings>
    
    <!-- DataTemplates for dockable views -->
    <Window.DataTemplates>
        <!-- Tool windows -->
        <DataTemplate DataType="{x:Type dock:ProjectTreeToolViewModel}">
            <dockViews:ProjectTreeToolView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type dock:ConsoleToolViewModel}">
            <dockViews:ConsoleToolView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type dock:InspectorToolViewModel}">
            <dockViews:InspectorToolView/>
        </DataTemplate>
        
        <!-- Document windows -->
        <DataTemplate DataType="{x:Type dock:GlobalSettingsDocumentViewModel}">
            <dockViews:GlobalSettingsDocumentView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type dock:PropertiesDocumentViewModel}">
            <dockViews:PropertiesDocumentView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type dock:ResourcesDocumentViewModel}">
            <dockViews:ResourcesDocumentView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type dock:MetagenDocumentViewModel}">
            <dockViews:MetagenDocumentView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type dock:RenderOutputDocumentViewModel}">
            <dockViews:RenderOutputDocumentView/>
        </DataTemplate>
    </Window.DataTemplates>
    
    <!-- Native Menu (appears in macOS menu bar, falls back to in-window on Windows/Linux) -->
    <NativeMenu.Menu>
        <NativeMenu>
            <NativeMenuItem Header="File">
                <NativeMenu>
                    <NativeMenuItem Header="Open Project..." Command="{Binding OpenProjectCommand}" Gesture="Cmd+O"/>
                    <NativeMenuItem Header="Open Recent">
                        <NativeMenu/>
                    </NativeMenuItem>
                    <NativeMenuItemSeparator/>
                    <NativeMenuItem Header="Save Project" Command="{Binding SaveProjectCommand}" Gesture="Cmd+S"/>
                    <NativeMenuItem Header="Save Project As..." Command="{Binding SaveProjectAsCommand}"/>
                    <NativeMenuItemSeparator/>
                    <NativeMenuItem Header="Exit" Command="{Binding ExitCommand}"/>
                </NativeMenu>
            </NativeMenuItem>
            <NativeMenuItem Header="Edit">
                <NativeMenu>
                    <NativeMenuItem Header="Undo" IsEnabled="False"/>
                    <NativeMenuItem Header="Redo" IsEnabled="False"/>
                    <NativeMenuItemSeparator/>
                    <NativeMenuItem Header="Settings..." Command="{Binding OpenSettingsCommand}" Gesture="Cmd+,"/>
                    <NativeMenuItem Header="Keyboard Shortcuts..." Command="{Binding OpenKeybindingsCommand}" Gesture="Cmd+Shift+K"/>
                </NativeMenu>
            </NativeMenuItem>
            <NativeMenuItem Header="View">
                <NativeMenu>
                    <NativeMenuItem Header="Quick Open..." Command="{Binding OpenQuickOpenCommand}" Gesture="Cmd+P"/>
                    <NativeMenuItem Header="Command Palette..." Command="{Binding OpenCommandPaletteCommand}" Gesture="Cmd+Shift+P"/>
                    <NativeMenuItemSeparator/>
                    <NativeMenuItem Header="Reset Layout" Command="{Binding ResetLayoutCommand}"/>
                </NativeMenu>
            </NativeMenuItem>
            <NativeMenuItem Header="Project">
                <NativeMenu>
                    <NativeMenuItem Header="Build" Command="{Binding BuildProjectCommand}" Gesture="Cmd+Shift+B"/>
                    <NativeMenuItemSeparator/>
                    <NativeMenuItem Header="Global Settings" Command="{Binding OpenGlobalSettingsEditorCommand}"/>
                    <NativeMenuItem Header="Properties" Command="{Binding OpenPropertiesEditorCommand}"/>
                    <NativeMenuItem Header="Resources" Command="{Binding OpenResourcesEditorCommand}"/>
                    <NativeMenuItem Header="Metagen" Command="{Binding OpenMetagenEditorCommand}"/>
                </NativeMenu>
            </NativeMenuItem>
            <NativeMenuItem Header="Run">
                <NativeMenu>
                    <NativeMenuItem Header="Start" Command="{Binding RunGameCommand}" Gesture="F5"/>
                    <NativeMenuItem Header="Start with Debugger" Command="{Binding DebugGameCommand}" Gesture="Cmd+F5"/>
                    <NativeMenuItem Header="Stop" Command="{Binding StopGameCommand}" Gesture="Shift+F5"/>
                </NativeMenu>
            </NativeMenuItem>
            <NativeMenuItem Header="Help">
                <NativeMenu>
                    <NativeMenuItem Header="About Aihao"/>
                </NativeMenu>
            </NativeMenuItem>
        </NativeMenu>
    </NativeMenu.Menu>
    
    <DockPanel>
        <!-- NativeMenuBar: shows as in-window menu on Windows/Linux, hidden on macOS (uses native menu bar) -->
        <NativeMenuBar DockPanel.Dock="Top"/>
        
        <!-- Toolbar -->
        <Border DockPanel.Dock="Top" Background="{StaticResource ToolbarBackgroundBrush}" Padding="4">
            <StackPanel Orientation="Horizontal" Spacing="4">
                <Button Content="ðŸ“‚" ToolTip.Tip="Open Project" Command="{Binding OpenProjectCommand}"/>
                <Button Content="ðŸ’¾" ToolTip.Tip="Save Project" Command="{Binding SaveProjectCommand}" IsEnabled="{Binding IsProjectLoaded}"/>
                <Separator/>
                <Button Content="ðŸ”¨" ToolTip.Tip="Build (Ctrl+Shift+B)" Command="{Binding BuildProjectCommand}" IsEnabled="{Binding IsProjectLoaded}"/>
                <Separator/>
                <Button Content="â–¶ï¸" ToolTip.Tip="Run (F5)" Command="{Binding RunGameCommand}" IsEnabled="{Binding IsProjectLoaded}" IsVisible="{Binding !IsGameRunning}"/>
                <Button Content="ðŸ›" ToolTip.Tip="Debug (Ctrl+F5)" Command="{Binding DebugGameCommand}" IsEnabled="{Binding IsProjectLoaded}" IsVisible="{Binding !IsGameRunning}"/>
                <Button Content="â¹ï¸" ToolTip.Tip="Stop (Shift+F5)" Command="{Binding StopGameCommand}" IsVisible="{Binding IsGameRunning}"/>
            </StackPanel>
        </Border>
        
        <!-- Status Bar -->
        <Border DockPanel.Dock="Bottom" Background="{StaticResource ToolbarBackgroundBrush}" Padding="8,4">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Text="{Binding StatusMessage}" VerticalAlignment="Center"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="16">
                    <TextBlock Text="{Binding Console.StatusText}" Opacity="0.7" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Docking Layout -->
        <idc:DockControl Layout="{Binding DockLayout}"
                         InitializeLayout="True"
                         InitializeFactory="True"/>
    </DockPanel>
</Window>
