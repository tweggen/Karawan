<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:Aihao.ViewModels"
        xmlns:dock="using:Aihao.ViewModels.Dock"
        xmlns:views="using:Aihao.Views"
        xmlns:dockViews="using:Aihao.Views.Dock"
        xmlns:idc="clr-namespace:Dock.Avalonia.Controls;assembly=Dock.Avalonia"
        mc:Ignorable="d" d:DesignWidth="1400" d:DesignHeight="900"
        x:Class="Aihao.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding Title}"
        Width="1400" Height="900"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource EditorBackgroundBrush}">
    
    <Window.KeyBindings>
        <KeyBinding Gesture="Ctrl+O" Command="{Binding OpenProjectCommand}"/>
        <KeyBinding Gesture="Ctrl+S" Command="{Binding SaveProjectCommand}"/>
        <KeyBinding Gesture="Ctrl+Shift+B" Command="{Binding BuildProjectCommand}"/>
        <KeyBinding Gesture="F5" Command="{Binding RunGameCommand}"/>
        <KeyBinding Gesture="Ctrl+F5" Command="{Binding DebugGameCommand}"/>
        <KeyBinding Gesture="Shift+F5" Command="{Binding StopGameCommand}"/>
        <KeyBinding Gesture="Ctrl+OemComma" Command="{Binding OpenSettingsCommand}"/>
        <KeyBinding Gesture="Ctrl+Shift+K" Command="{Binding OpenKeybindingsCommand}"/>
        <KeyBinding Gesture="Ctrl+P" Command="{Binding OpenQuickOpenCommand}"/>
        <KeyBinding Gesture="Ctrl+Shift+P" Command="{Binding OpenCommandPaletteCommand}"/>
    </Window.KeyBindings>
    
    <!-- DataTemplates for dockable views -->
    <Window.DataTemplates>
        <!-- Tool windows -->
        <DataTemplate DataType="{x:Type dock:ProjectTreeToolViewModel}">
            <dockViews:ProjectTreeToolView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type dock:ConsoleToolViewModel}">
            <dockViews:ConsoleToolView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type dock:InspectorToolViewModel}">
            <dockViews:InspectorToolView/>
        </DataTemplate>
        
        <!-- Document windows -->
        <DataTemplate DataType="{x:Type dock:GlobalSettingsDocumentViewModel}">
            <dockViews:GlobalSettingsDocumentView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type dock:PropertiesDocumentViewModel}">
            <dockViews:PropertiesDocumentView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type dock:ResourcesDocumentViewModel}">
            <dockViews:ResourcesDocumentView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type dock:MetagenDocumentViewModel}">
            <dockViews:MetagenDocumentView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type dock:RenderOutputDocumentViewModel}">
            <dockViews:RenderOutputDocumentView/>
        </DataTemplate>
    </Window.DataTemplates>
    
    <DockPanel>
        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top" Background="{StaticResource ToolbarBackgroundBrush}">
            <MenuItem Header="_File">
                <MenuItem Header="_Open Project..." Command="{Binding OpenProjectCommand}" InputGesture="Ctrl+O"/>
                <Separator/>
                <MenuItem Header="_Save Project" Command="{Binding SaveProjectCommand}" InputGesture="Ctrl+S" IsEnabled="{Binding IsProjectLoaded}"/>
                <MenuItem Header="Save Project _As..." Command="{Binding SaveProjectAsCommand}" IsEnabled="{Binding IsProjectLoaded}"/>
                <Separator/>
                <MenuItem Header="Recent Projects" ItemsSource="{Binding RecentProjects}" IsEnabled="{Binding RecentProjects.Count}">
                    <MenuItem.ItemTemplate>
                        <DataTemplate>
                            <MenuItem Header="{Binding Name}" 
                                      Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).OpenRecentProjectCommand}"
                                      CommandParameter="{Binding}"
                                      ToolTip.Tip="{Binding Path}"/>
                        </DataTemplate>
                    </MenuItem.ItemTemplate>
                </MenuItem>
                <MenuItem Header="Clear Recent Projects" Command="{Binding ClearRecentProjectsCommand}"/>
                <Separator/>
                <MenuItem Header="E_xit" Command="{Binding ExitCommand}"/>
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem Header="_Undo" IsEnabled="False"/>
                <MenuItem Header="_Redo" IsEnabled="False"/>
                <Separator/>
                <MenuItem Header="_Settings..." Command="{Binding OpenSettingsCommand}" InputGesture="Ctrl+,"/>
                <MenuItem Header="_Keyboard Shortcuts..." Command="{Binding OpenKeybindingsCommand}" InputGesture="Ctrl+Shift+K"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="_Quick Open..." Command="{Binding OpenQuickOpenCommand}" InputGesture="Ctrl+P"/>
                <MenuItem Header="_Command Palette..." Command="{Binding OpenCommandPaletteCommand}" InputGesture="Ctrl+Shift+P"/>
                <Separator/>
                <MenuItem Header="Reset Layout" Command="{Binding ResetLayoutCommand}"/>
            </MenuItem>
            <MenuItem Header="_Project" IsEnabled="{Binding IsProjectLoaded}">
                <MenuItem Header="_Build" Command="{Binding BuildProjectCommand}" InputGesture="Ctrl+Shift+B"/>
                <Separator/>
                <MenuItem Header="_Global Settings" Command="{Binding OpenGlobalSettingsEditorCommand}"/>
                <MenuItem Header="_Properties" Command="{Binding OpenPropertiesEditorCommand}"/>
                <MenuItem Header="_Resources" Command="{Binding OpenResourcesEditorCommand}"/>
                <MenuItem Header="_Metagen" Command="{Binding OpenMetagenEditorCommand}"/>
            </MenuItem>
            <MenuItem Header="_Run" IsEnabled="{Binding IsProjectLoaded}">
                <MenuItem Header="_Start" Command="{Binding RunGameCommand}" InputGesture="F5" IsEnabled="{Binding !IsGameRunning}"/>
                <MenuItem Header="Start with _Debugger" Command="{Binding DebugGameCommand}" InputGesture="Ctrl+F5" IsEnabled="{Binding !IsGameRunning}"/>
                <MenuItem Header="_Stop" Command="{Binding StopGameCommand}" InputGesture="Shift+F5" IsEnabled="{Binding IsGameRunning}"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About Aihao"/>
            </MenuItem>
        </Menu>
        
        <!-- Toolbar -->
        <Border DockPanel.Dock="Top" Background="{StaticResource ToolbarBackgroundBrush}" Padding="4">
            <StackPanel Orientation="Horizontal" Spacing="4">
                <Button Content="ðŸ“‚" ToolTip.Tip="Open Project" Command="{Binding OpenProjectCommand}"/>
                <Button Content="ðŸ’¾" ToolTip.Tip="Save Project" Command="{Binding SaveProjectCommand}" IsEnabled="{Binding IsProjectLoaded}"/>
                <Separator/>
                <Button Content="ðŸ”¨" ToolTip.Tip="Build (Ctrl+Shift+B)" Command="{Binding BuildProjectCommand}" IsEnabled="{Binding IsProjectLoaded}"/>
                <Separator/>
                <Button Content="â–¶ï¸" ToolTip.Tip="Run (F5)" Command="{Binding RunGameCommand}" IsEnabled="{Binding IsProjectLoaded}" IsVisible="{Binding !IsGameRunning}"/>
                <Button Content="ðŸ›" ToolTip.Tip="Debug (Ctrl+F5)" Command="{Binding DebugGameCommand}" IsEnabled="{Binding IsProjectLoaded}" IsVisible="{Binding !IsGameRunning}"/>
                <Button Content="â¹ï¸" ToolTip.Tip="Stop (Shift+F5)" Command="{Binding StopGameCommand}" IsVisible="{Binding IsGameRunning}"/>
            </StackPanel>
        </Border>
        
        <!-- Status Bar -->
        <Border DockPanel.Dock="Bottom" Background="{StaticResource ToolbarBackgroundBrush}" Padding="8,4">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Text="{Binding StatusMessage}" VerticalAlignment="Center"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="16">
                    <TextBlock Text="{Binding Console.StatusText}" Opacity="0.7" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Docking Layout -->
        <idc:DockControl Layout="{Binding DockLayout}"
                         InitializeLayout="True"
                         InitializeFactory="True"/>
    </DockPanel>
</Window>
