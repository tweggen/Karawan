<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:Aihao.ViewModels"
        mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="350"
        x:Class="Aihao.Views.CommandPalette"
        x:DataType="vm:CommandPaletteViewModel"
        Title="Command Palette"
        Width="500"
        SizeToContent="Height"
        MaxHeight="400"
        WindowStartupLocation="CenterOwner"
        CanResize="False"
        ShowInTaskbar="False"
        SystemDecorations="BorderOnly"
        Background="Transparent"
        TransparencyLevelHint="Transparent">
    
    <Window.Styles>
        <!-- Selected item style -->
        <Style Selector="Border.palette-item">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="CornerRadius" Value="2"/>
        </Style>
        <Style Selector="Border.palette-item.selected">
            <Setter Property="Background" Value="#007ACC"/>
        </Style>
        <Style Selector="Border.palette-item:pointerover">
            <Setter Property="Background" Value="#3E3E42"/>
        </Style>
        <Style Selector="Border.palette-item.selected:pointerover">
            <Setter Property="Background" Value="#007ACC"/>
        </Style>
    </Window.Styles>
    
    <Border Background="{StaticResource PanelBackgroundBrush}"
            BorderBrush="{StaticResource ToolbarBackgroundBrush}"
            BorderThickness="1"
            CornerRadius="4"
            Padding="0"
            BoxShadow="0 4 16 0 #40000000">
        <StackPanel>
            <!-- Search box at top -->
            <Border Padding="6">
                <TextBox x:Name="SearchBox"
                         Text="{Binding SearchText}"
                         Watermark="{Binding Placeholder}"
                         Padding="6,4"
                         BorderThickness="0"
                         Background="{StaticResource EditorBackgroundBrush}"
                         CornerRadius="2"/>
            </Border>
            
            <!-- Separator -->
            <Border Height="1" 
                    Background="{StaticResource ToolbarBackgroundBrush}"/>
            
            <!-- Results list (when has items) -->
            <ScrollViewer x:Name="ResultsScroller"
                          HorizontalScrollBarVisibility="Disabled"
                          VerticalScrollBarVisibility="Auto"
                          MaxHeight="320"
                          IsVisible="{Binding FilteredItems.Count}">
                <ItemsControl ItemsSource="{Binding FilteredItems}" Margin="4">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="vm:CommandPaletteItemVM">
                            <Border Classes="palette-item"
                                    Classes.selected="{Binding IsSelected}"
                                    PointerPressed="OnItemPointerPressed"
                                    Cursor="Hand">
                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <!-- Icon -->
                                    <TextBlock Grid.Column="0"
                                               Text="{Binding Icon}"
                                               VerticalAlignment="Center"
                                               Margin="0,0,8,0"
                                               Width="18"
                                               IsVisible="{Binding Icon, Converter={x:Static ObjectConverters.IsNotNull}}"/>
                                    
                                    <!-- Name and description -->
                                    <StackPanel Grid.Column="1" Spacing="0" VerticalAlignment="Center">
                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                            <TextBlock Text="{Binding DisplayName}" 
                                                       FontWeight="SemiBold"/>
                                            <TextBlock Text="{Binding Category}"
                                                       Opacity="0.5"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                        <TextBlock Text="{Binding Description}"
                                                   Opacity="0.6"
                                                   TextTrimming="CharacterEllipsis"
                                                   IsVisible="{Binding Description, Converter={x:Static ObjectConverters.IsNotNull}}"/>
                                    </StackPanel>
                                    
                                    <!-- Keybinding -->
                                    <Border Grid.Column="2"
                                            Background="{StaticResource ToolbarBackgroundBrush}"
                                            CornerRadius="2"
                                            Padding="4,1"
                                            VerticalAlignment="Center"
                                            IsVisible="{Binding KeyBindingDisplay, Converter={x:Static ObjectConverters.IsNotNull}}">
                                        <TextBlock Text="{Binding KeyBindingDisplay}"
                                                   FontFamily="Consolas,Menlo,monospace"
                                                   Opacity="0.8"/>
                                    </Border>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
            
            <!-- Empty state (when no items) -->
            <TextBlock Text="No results found"
                       HorizontalAlignment="Center"
                       Opacity="0.5"
                       Margin="12"
                       IsVisible="{Binding !FilteredItems.Count}"/>
        </StackPanel>
    </Border>
</Window>
